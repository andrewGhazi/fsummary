---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# fsummary

<!-- badges: start -->
<!-- badges: end -->

The goal of fsummary is to compute posterior summaries from `cmdstanr` FAST!

## Installation

You can install the development version of fsummary from [GitHub](https://github.com/) with:

``` r
remotes::install_github("andrewGhazi/fsummary")
```

## Example

This is a basic example which shows you how to solve a common problem:

```{r example, message=FALSE}
library(fsummary)
library(collapse)
library(posterior)

options(digits = 3)

ddf = rnorm(4e3*100) |> # fake 1k draws of 100 example variables from each of 4 chains
  matrix(ncol = 100) |> 
  qDT() |> 
  mtt(`.draw` = 1:4e3,
      `.iteration` = rep(1:1000, times = 4),
      `.chain` = rep(1:4, each = 1000)) |> 
  posterior::as_draws_df()

fsummary(ddf) |> # instead of posterior::summarise_draws(ddf)
  head() 
```

On one core, it's roughly twice as fast as `summarise_draws()` when computing convergence metrics and ~5x faster without. Example:

```{r, eval = FALSE}
microbenchmark::microbenchmark({summarise_draws(ddf)},
                               {fsummary(ddf, .cores = 1)},
                               times = 3)
```

```
Unit: milliseconds
                              expr min  lq mean median  uq max neval
      {     summarise_draws(ddf) } 666 671  691    677 703 729     3
 {     fsummary(ddf, .cores = 1) } 278 278  283    278 285 292     3
```

```{r, eval = FALSE}
microbenchmark::microbenchmark({summarise_draws(ddf, default_summary_measures())},
                               {fsummary(ddf, .cores = 1, conv_metrics = FALSE)},
                               times = 3)
```

```
Unit: milliseconds
                                                expr   min    lq  mean median    uq   max neval
{ summarise_draws(ddf, default_summary_measures()) } 114.4 114.5 130.4  114.6 138.3 162.1     3
 { fsummary(ddf, .cores = 1, conv_metrics = FALSE) }  18.6  18.7  19.3   18.9  19.6  20.3     3
```

